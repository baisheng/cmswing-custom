{% extends "../inc/base.html" %}
{% block style %}
    {#<link rel="stylesheet" href="/static/admin/js/zTree/metroStyle/metroStyle.css" type="text/css">#}
    <link rel="stylesheet" href="/static/admin/js/zTree/zTreeStyle/zTreeStyle.css" type="text/css">
    <style>
        .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td {
            vertical-align: middle;
        }
    </style>
{% endblock %}

{% block sidebar %}
    {% include "../inc/article_side.html" %}
{% endblock %}

{% block pageHeader %}
    <!-- Page header -->
    <div class="page-header">
        <div class="page-header-content">

            <div class="page-title">

                <h4>
                    <span
                            class="text-semibold"></span> - {{ controller.meta_title }}</h4>
            </div>
            <div class="heading-elements">

                {#<a href="/admin/category/add" class="btn btn-labeled btn-labeled-right bg-primary heading-btn">#}
                <!--<i class="fa fa-plus text"></i>-->
                {#<span class="text">添加栏目</span>#}
                {#<b><i class=" icon-add"></i></b>#}

                <!--<i class="fa fa-minus text-active"></i>-->
                <!--<span class="text-active">添加完成</span>-->
                {#</a>#}
            </div>
        </div>
        <div class="breadcrumb-line breadcrumb-line-component">

            <a class="breadcrumb-elements-toggle">
                -
                <i class="icon-menu-open"></i></a>

            <!-- .breadcrumb -->
            <ul class="breadcrumb">
                <li><a href="index.html"><i class="icon-home2 position-left"></i> 首页</a></li>

                <li><a href="/admin/article/index"><i class=""></i> 网站内容</a></li>
                {% for nav in breadcrumb %} {% if cate_id == nav.id %}
                    <li class="active">{{ nav.title }} <span
                                class="badge bg-primary">{{ _total }}</span> {% if allow == 0 %}<span
                                class="label btn-warning">（该分类不允许发布内容）</span>{% endif %}
                    </li>
                {% else %}
                    <li><a href="/admin/article/index/cate_id/{{ nav.id }}"><i class="fa fa-list-ul"></i>
                            {{ nav.title }}</a></li>
                {% endif %} {% endfor %} {% if article.id >0 %}
                    <li><i class="fa fa-list-ul"></i> {{ article.title }}</li>
                {% endif %}
            </ul>

            <ul class="breadcrumb-elements">
                {% if breadcrumb|length == 0 %}
                    {% if position %}
                        <li>
                            <a href="/admin/article/index" class="">全部</a>
                        </li>

                    {% else %}
                        <li><a href="#"><i class="fa fa-dot-circle-o"></i> <strong>全部</strong></a></li>
                    {% endif %}

                    {% for key ,val in controller.setup.DOCUMENT_POSITION %}
                        {% if position != key %}
                            <li>
                                <a href="/admin/article/index/position/{{ key }}" class="">{{ val }}</a></li>

                        {% else %}
                            <li><a href="#"><i class="fa fa-dot-circle-o"></i> <strong>{{ val }}</strong></a></li>

                        {% endif %}&nbsp;
                    {% endfor %}
                {% endif %}
                {% if model|length > 1 %} 模型：{% if model_id ==null %}
                    <li><a href="#"><i class="fa fa-dot-circle-o"></i> <strong>全部</strong></a></li>

                {% else %}
                {% endif %}&nbsp;

                    {% for val in modellist %} {% if model_id != val.id %}
                        <li>
                            <a href="/admin/article/index/model_id/{{ val.id }}/pid/{{ pid }}/cate_id/{{ cate_id }}"
                               class="">{{ val.title }}</a></li>
                    {% else %}
                        <li><a href="#"><i class="fa fa-dot-circle-o"></i> <strong>{{ val.title }}</strong></a></li>

                    {% endif %}&nbsp;
                    {% endfor %}
                {% endif %}
                {% if groups %}[ 分组：{% if group_id ==0 %}
                    <li><a href="#"><i class="fa fa-dot-circle-o"></i> <strong>全部</strong></a></li>
                {% else %}
                    <li>
                        <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}" class="">全部</a></li>
                {% endif %}
                    {% for key ,val in groups %} {% if group_id != key %}
                        <li>
                            <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ key }}/sortid/{{ sortid }}"
                               class="">{{ val }}</a>
                        </li>
                    {% else %}
                        <li><a href="#"><i class="fa fa-dot-circle-o"></i> <strong>{{ val }}</strong></a></li>

                    {% endif %} {% endfor %} ]{% endif %}

            </ul>

        </div>


    </div>
    <!-- /page header -->

{% endblock %}

{% block content %}

    <div class="panel panel-flat">

        <div class="panel-heading">
            <h6 class="panel-title">
                <i class="fa fa-table position-left"></i>
            </h6>

            <!--<h5 class="panel-title">Simple panel</h5>-->
            <div class="heading-elements">

                <div class="heading-btn">
                    <div class="btn-group">
                        <button {% if model|length> 1 %} data-toggle="dropdown" {% endif %} class="btn btn-default btn-sm
                        document_add
                        dropdown-toggle {% if allow == 0 %}disabled{% endif %}" {% if model|length
                            == 1 %} url="/admin/article/add?model_id={{ modellist[0].id }}&pid={{ pid }}&cate_id={{ cate_id }}&group_id={{ group_id }}&sortid={{ sortid }}"{% endif %}
                        >添加内容 {% if model|length > 1 %}<span class="caret"></span>{% endif %}
                        </button>
                        {% if model|length > 1 %}
                            <ul class="dropdown-menu">

                                {% for val in modellist %}
                                    <li>
                                    <li>
                                        <a href="/admin/article/add?model_id={{ val.id }}&pid={{ pid }}&cate_id={{ cate_id }}&group_id={{ group_id }}&sortid={{ sortid }}"
                                           class="">添加{{ val.title }}</a></li>
                                {% endfor %}

                            </ul>
                        {% endif %}
                    </div>
                    <div class="btn-group">
                        <a class="btn btn-sm btn-default ajax-post" target-form="ids"
                           href="/admin/article/setstatus?status=1" target-form="ids">
                            审核
                        </a>
                        <a class="btn btn-sm btn-default ajax-post" href="/admin/article/setstatus?status=0"
                           target-form="ids">
                            禁用
                        </a>
                    </div>
                    <div class="btn-group">
                        <a class="btn btn-sm btn-default todo" target-form="ids"  href="/{{ctx.controller}}/move">
                            移动
                        </a>
                        <a class="btn btn-sm btn-default todo" target-form="ids" href="/{{ctx.controller}}/copy">
                            复制
                        </a>
                        <a class="btn btn-sm btn-default todo" target-form="ids" hide-data="true" href="/{{ctx.controller}}/paste">
                            粘贴
                            <input type="hidden" class="hide-data" name="cate_id" value="{{cate_id}}">
                            <input type="hidden" class="hide-data" name="pid" value="{{pid}}">
                            <input type="hidden" class="hide-data" name="sort_id" value="{{sortid}}">
                        </a>
                    </div>

                    <a class="btn btn-sm btn-default ajax-post confirm" target-form="ids"
                       href="/admin/article/setstatus?status=-1">
                        删除
                    </a>
                    <a class="btn btn-sm btn-default todo" target-form="ids" href="#">
                        排序
                    </a>

                </div>

                <form class="heading-form">
                    <div class="input-group pull-right search-form">
                        <input type="text" class="input-sm form-control"
                               name="{{ model.search_key|default('title', true) }}"
                               placeholder="请输入关键字"
                               value="{{ controller.get('title') }}">
                        <span class="input-group-btn">
                            {#<button type="button" class="btn btn-info btn-float btn-rounded legitRipple"><i class="icon-search4"></i></button>#}
                            <button class="btn btn-sm btn-default" type="button" id="search" url="/admin/article/index?pid={{pid}}{%if cate_id >0%}&cate_id={{cate_id}}{%endif%}">搜索</button>

                            <i class="icon-search4"></i>
                        </button>
                      </span>
                    </div>

                </form>

            </div>
        </div>


        {% if sort %}
            <div class="tabbable tab-content-bordered ">
                <ul class="nav nav-tabs nav-tabs-bottom">
                    {% for val in sort.types %}
                        <li class="{% if controller.get('sortid')|length > 0 %}{% if controller.get('sortid')==val.enable %}active{% endif %}{% else %}{% if sort.defaultshow == val.enable %}active{% endif %}{% endif %}">
                            <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ val.enable }}">
                                {{ val.name }}</a>
                        </li>
                    {% endfor %}
                </ul>

            </div>

            <div class="panel panel-default clearfix">
                {# <header class="panel-heading text-right bg-light clearfix">
                     <ul class="nav nav-tabs pull-left">
                         {% for val in sort.types %}
                             <li class="{% if controller.get('sortid')|length > 0 %}{% if controller.get('sortid')==val.enable %}active{% endif %}{% else %}{% if sort.defaultshow == val.enable %}active{% endif %}{% endif %}">
                                 <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ val.enable }}">
                                     {{ val.name }}</a>
                             </li>
                         {% endfor %}
                     </ul>
                     <ul class="nav nav-pills pull-right">
                         <li>
                             <a href="#" class="panel-toggle text-muted" id="sorttoggle"><i
                                         class="fa fa-caret-down text"></i><i class="fa fa-caret-up text-active"></i></a>
                         </li>
                     </ul>

                 </header>
                 #}

                <div class="panel-body collapse" id="sortbody" style="padding: 0">
                    <div class="tab-content">
                        <table class="table table-hover table-condensed m-b-none" style="margin-top: -1px">
                            <tbody>
                            {% for val in typevar %}
                                {% if val.search > 1 and val.available==1 %}
                                    <tr>
                                        <td style="width: 140px" class="text-right">
                                            {{ val.option.title }}:
                                        </td>
                                        <td>
                                            {% if 0 == nsobj[val.option.identifier] or null == nsobj[val.option.identifier] %}
                                                <span style="margin-right: 10px">全部</span>
                                            {% else %}
                                                <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}/sortval/{{ 0|sort_url(val.option.identifier,typevar,nsobj) }}"
                                                   class="" style="margin-right: 10px">全部</a>
                                            {% endif %}
                                            {% for v in val.rules %}
                                                {% if v.id|sort_act(nsobj[val.option.identifier]) %}
                                                    <span style="margin-right: 10px">{{ v.name }}{{ val.option.unit }}</span>
                                                {% else %}
                                                    <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}/sortval/{{ v.id|sort_url(val.option.identifier,typevar,nsobj) }}"
                                                       class=""
                                                       style="margin-right: 10px">{{ v.name }}{{ val.option.unit }}</a>
                                                {% endif %}
                                            {% endfor %}

                                            <!--子栏目-->
                                            {% for v in val.rules %}
                                            {% if v.id|sort_act(nsobj[val.option.identifier]) %}
                                            {% if v.children %}
                                            <div class="subtsm">

                                                {% for v_ in v.children %}
                                                    {% if v_.id|sort_act(nsobj[val.option.identifier]) %}
                                                        <span style="margin-right: 10px">{{ v_.name }}{{ val.option.unit }}</span>
                                                    {% else %}
                                                        <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}/sortval/{{ v_.id|sort_url(val.option.identifier,typevar,nsobj) }}"
                                                           class=""
                                                           style="margin-right: 10px">{{ v_.name }}{{ val.option.unit }}</a>
                                                    {% endif %}
                                                {% endfor %}
                                                <li><a href="/admin/article/index/cate_id/{{ nav.id }}"><i
                                                                class="fa fa-list-ul"></i> {{ nav.title }}</a></li>

                                                {% if article.id >0 %}
                                                    <li> <i class="fa fa-list-ul"></i> {{ article.title }}
                                                    </li>{% endif %}
                                                </ul>
                                                <!-- / .breadcrumb -->
                                                {% if sort %}
                                                    <section class="panel panel-default m-b-xs clearfix">
                                                        <header class="panel-heading text-right bg-light clearfix">
                                                            <ul class="nav nav-tabs pull-left">
                                                                {% for val in sort.types %}
                                                                    <li class="{% if controller.get('sortid')|length > 0 %}{% if controller.get('sortid')==val.enable %}active{% endif %}{% else %}{% if sort.defaultshow == val.enable %}active{% endif %}{% endif %}">
                                                                        <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ val.enable }}"> {{ val.name }}</a>
                                                                    </li>
                                                                {% endfor %}
                                                            </ul>
                                                            <ul class="nav nav-pills pull-right">
                                                                <li>
                                                                    <a href="#" class="panel-toggle text-muted"
                                                                       id="sorttoggle"><i
                                                                                class="fa fa-caret-down text"></i><i
                                                                                class="fa fa-caret-up text-active"></i></a>
                                                                </li>
                                                            </ul>
                                                        </header>
                                                        <div class="panel-body collapse" id="sortbody"
                                                             style="padding: 0">
                                                            <div class="tab-content">
                                                                <table class="table table-hover table-condensed m-b-none"
                                                                       style="margin-top: -1px">
                                                                    <tbody>
                                                                    {% for val in typevar %}
                                                                        {% if val.search > 1 and val.available==1 %}
                                                                            <tr>
                                                                                <td style="width: 140px"
                                                                                    class="text-right">
                                                                                    {{ val.option.title }}:
                                                                                </td>
                                                                                <td>
                                                                                    {% if 0 == nsobj[val.option.identifier] or null == nsobj[val.option.identifier] %}
                                                                                        <span style="margin-right: 10px">全部</span>
                                                                                    {% else %}
                                                                                        <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}/sortval/{{ 0|sort_url(val.option.identifier,typevar,nsobj) }}"
                                                                                           class="text-primary"
                                                                                           style="margin-right: 10px">全部</a>
                                                                                    {% endif %}
                                                                                    {% for v in val.rules %}
                                                                                        {% if v.id|sort_act(nsobj[val.option.identifier]) %}
                                                                                            <span style="margin-right: 10px">{{ v.name }}{{ val.option.unit }}</span>
                                                                                        {% else %}
                                                                                            <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}/sortval/{{ v.id|sort_url(val.option.identifier,typevar,nsobj) }}"
                                                                                               class="text-primary"
                                                                                               style="margin-right: 10px">{{ v.name }}{{ val.option.unit }}</a>
                                                                                        {% endif %}
                                                                                    {% endfor %}

                                                                                    <!--子栏目-->
                                                                                    {% for v in val.rules %}
                                                                                        {% if v.id|sort_act(nsobj[val.option.identifier]) %}
                                                                                            {% if v.children %}
                                                                                                <div class="subtsm">

                                                                                                    {% for v_ in v.children %}
                                                                                                        {% if v_.id|sort_act(nsobj[val.option.identifier]) %}
                                                                                                            <span style="margin-right: 10px">{{ v_.name }}{{ val.option.unit }}</span>
                                                                                                        {% else %}
                                                                                                            <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}/sortval/{{ v_.id|sort_url(val.option.identifier,typevar,nsobj) }}"
                                                                                                               class="text-primary"
                                                                                                               style="margin-right: 10px">{{ v_.name }}{{ val.option.unit }}</a>
                                                                                                        {% endif %}
                                                                                                    {% endfor %}
                                                                                                </div>
                                                                                            {% endif %}
                                                                                        {% endif %}
                                                                                    {% endfor %}
                                                                                    <!--子栏目-->
                                                                                    {% for v in val.rules %}
                                                                                        {% if v.id|sort_act(nsobj[val.option.identifier]) %}
                                                                                            {% if v.children %}

                                                                                                {% for v_ in v.children %}
                                                                                                    {% if v_.id|sort_act(nsobj[val.option.identifier]) %}
                                                                                                        {% if v_.children %}
                                                                                                            <div class="subtsm">
                                                                                                                {% for v__ in v_.children %}

                                                                                                                    {% if v__.id|sort_act(nsobj[val.option.identifier]) %}

                                                                                                                        <span style="margin-right: 10px">{{ v__.name }}{{ val.option.unit }}</span>
                                                                                                                    {% else %}
                                                                                                                        <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}/sortval/{{ v__.id|sort_url(val.option.identifier,typevar,nsobj) }}"
                                                                                                                           class="text-primary"
                                                                                                                           style="margin-right: 10px">{{ v__.name }}{{ val.option.unit }}</a>

                                                                                                                    {% endif %}
                                                                                                                {% endfor %}
                                                                                                            </div>
                                                                                                        {% endif %}
                                                                                                    {% endif %}
                                                                                                {% endfor %}

                                                                                            {% endif %}
                                                                                        {% endif %}
                                                                                    {% endfor %}
                                                                                </td>

                                                                            </tr>
                                                                        {% endif %}
                                                                    {% endfor %}

                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </section>
                                                {% endif %}
                                                <section class="panel panel-default">
                                                    <header class="panel-heading">
                                                        <!--<i data-title="" data-placement="bottom" data-toggle="tooltip" class="fa fa-info-sign text-muted" data-original-title="" title=""><i class="fa fa-question-circle"></i></i>-->

                                                        {% if breadcrumb|length == 0 %} [ {% if position %} <a
                                                                href="/admin/article/index"
                                                                class="text-primary">全部</a>{% else %}
                                                            <strong>全部</strong>{% endif %}
                                                            {% for key ,val in controller.setup.DOCUMENT_POSITION %} {% if position != key %}
                                                                <a href="/admin/article/index/position/{{ key }}"
                                                                   class="text-primary">{{ val }}</a>{% else %}
                                                                <strong>{{ val }}</strong>{% endif %}&nbsp; {% endfor %}] {% endif %} {% if model|length > 1 %}[ 模型：{% if model_id ==null %}
                                                            <strong>全部</strong>{% else %}
                                                            <a
                                                                    href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}"
                                                                    class="text-primary">
                                                                全部 </a>{% endif %}&nbsp; {% for val in modellist %} {% if model_id != val.id %}
                                                            <a
                                                            href="/admin/article/index/model_id/{{ val.id }}/pid/{{ pid }}/cate_id/{{ cate_id }}"
                                                            class="text-primary">{{ val.title }}</a>{% else %}
                                                            <strong>{{ val.title }}</strong>{% endif %}&nbsp;
                                                        {% endfor %} ]{% endif %} {% if groups %}[ 分组：{% if group_id ==0 %}
                                                            <strong style="margin-right: 5px">全部</strong> {% else %} <a
                                                                href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}"
                                                                class="text-primary"
                                                                style="margin-right: 5px">全部</a> {% endif %} {% for key ,val in groups %} {% if group_id != key %}
                                                            <a
                                                            href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ key }}/sortid/{{ sortid }}"
                                                            class="text-primary">{{ val }}</a>{% else %}
                                                            <strong>{{ val }}</strong>{% endif %}&nbsp; {% endfor %} ]{% endif %}
                                                    </header>
                                                    <div class="row wrapper">

                                                        <div class="col-sm-9 m-b-xs">
                                                            <div class="">
                                                                <div class="btn-group">
                                                                    <button {% if model|length> 1 %} data-toggle="dropdown" {% endif %}
                                                                            class="btn btn-primary btn-sm document_add
                                                dropdown-toggle {% if allow == 0 %}disabled{% endif %}" {% if model|length
                                                                        == 1 %} url="/admin/article/add/model_id/{{ modellist[0].id }}/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}"{% endif %}
                                                                    >添加内容 {% if model|length > 1 %}<span
                                                                                class="caret"></span>{% endif %}
                                                                    </button>
                                                                    {% if model|length > 1 %}
                                                                        <ul class="dropdown-menu">

                                                                            {% for val in modellist %}
                                                                                <li>
                                                                                    <a href="/admin/article/add/model_id/{{ val.id }}/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}"
                                                                                       class="text-primary">添加{{ val.title }}</a>
                                                                                </li>
                                                                            {% endfor %}

                                                                            <!--<li class="divider"></li>-->
                                                                            <!--<li><a href="#">添加内容</a></li>-->
                                                                        </ul>
                                                                    {% endif %}
                                                                </div>
                                                                <div class="btn-group">
                                                                    <a class="btn btn-sm btn-primary ajax-post"
                                                                       target-form="ids"
                                                                       href="/admin/article/setstatus/status/1"
                                                                       target-form="ids">
                                                                        审核
                                                                    </a>
                                                                    <a class="btn btn-sm btn-primary ajax-post"
                                                                       href="/admin/article/setstatus/status/0"
                                                                       target-form="ids">
                                                                        禁用
                                                                    </a>
                                                                </div>
                                                                <div class="btn-group">
                                                                    <a class="btn btn-sm btn-primary todo"
                                                                       target-form="ids" href="#">
                                                                        移动
                                                                    </a>
                                                                    <a class="btn btn-sm btn-primary todo"
                                                                       target-form="ids" href="#">
                                                                        复制
                                                                    </a>
                                                                    <a class="btn btn-sm btn-primary todo"
                                                                       target-form="ids" href="#">
                                                                        粘贴
                                                                    </a>
                                                                </div>

                                                                <a class="btn btn-sm btn-primary ajax-post confirm"
                                                                   target-form="ids"
                                                                   href="/admin/article/setstatus/status/-1">
                                                                    删除
                                                                </a>
                                                                <a class="btn btn-sm btn-primary todo" target-form="ids"
                                                                   href="#">
                                                                    排序
                                                                </a>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="input-group pull-right search-form">
                                                                <input type="text" class="input-sm form-control"
                                                                       name="{{ model.search_key|default('title', true) }}"
                                                                       placeholder="请输入关键字"
                                                                       value="{{ controller.get('title') }}">
                                                                <span class="input-group-btn">
                        <button class="btn btn-sm btn-default" type="button" id="search"
                                url="/admin/article/index/pid/{{ pid }}{% if cate_id >0 %}/cate_id/{{ cate_id }}{% endif %}">搜索</button>
                      </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    {% endif %}
                                                    {% endfor %}
                                                    <!--子栏目-->
                                                    {% for v in val.rules %}
                                                        {% if v.id|sort_act(nsobj[val.option.identifier]) %}
                                                            {% if v.children %}

                                                                {% for v_ in v.children %}
                                                                    {% if v_.id|sort_act(nsobj[val.option.identifier]) %}
                                                                        {% if v_.children %}
                                                                            <div class="subtsm">
                                                                                {% for v__ in v_.children %}

                                                                                    {% if v__.id|sort_act(nsobj[val.option.identifier]) %}

                                                                                        <span style="margin-right: 10px">{{ v__.name }}{{ val.option.unit }}</span>
                                                                                    {% else %}
                                                                                        <a href="/admin/article/index/pid/{{ pid }}/cate_id/{{ cate_id }}/group_id/{{ group_id }}/sortid/{{ sortid }}/sortval/{{ v__.id|sort_url(val.option.identifier,typevar,nsobj) }}"
                                                                                           class=""
                                                                                           style="margin-right: 10px">{{ v__.name }}{{ val.option.unit }}</a>

                                                                                    {% endif %}
                                                                                {% endfor %}
                                                                            </div>
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% endfor %}

                                                            {% endif %}
                                                        {% endif %}
                                                    {% endfor %}
                                                </section>
                                            </div>
                                        </td>

                                    </tr>
                                {% endif %}
                            {% endfor %}

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        {% endif %}


        <div class="table-responsive">

            <table class="table table-striped">
                <thead>
                <tr>
                    <th style="width:20px;">
                        <input type="checkbox">
                    </th>
                    {% for field in list_grids %}
                        <th style="width: 40px;">{{ field.title }}</th>
                    {% endfor %}
                </tr>
                </thead>
                <tbody>
                {% for data in list %}
                    <tr>
                        <td>
                            <input class="ids" type="checkbox" name="ids" value="{{ data.id }}">
                        </td>
                        {% for grid in list_grids %}
                            <td>{{ data|get_list_field(grid,ctx.controller) | safe }}</td>
                        {% endfor %}
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="{{ list_grids|length + 1 }}">
                            <div class="alert alert-primary alert-block">
                                <button data-dismiss="alert" class="close" type="button">×</button>
                                <p>还没有内容。</p>
                            </div>
                        </td>
                    </tr>

                {% endfor %}


                </tbody>
            </table>
        </div>

        <footer class="panel-footer">
            <div class="col-md-3">
                <div class="btn-group">
                    <a class="btn btn-sm btn-default todo" target-form="ids" href="#">
                        微信图文
                    </a>
                    <a class="btn btn-sm btn-default todo" target-form="ids" href="#">
                        高级图文
                    </a>
                    <a class="btn btn-sm btn-default todo" target-form="ids" href="#">
                        推送
                    </a>
                </div>
            </div>

            <div class="col-md-9 text-right text-center-xs">
                {{ pagerData | safe }}
            </div>
        </footer>
    </div>
    <!-- /simple panel -->



{% endblock %}
{% block script %}
    <script src="/static/admin/js/zTree/jquery.ztree.core-3.5.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      <!--
      var zTree;
      var demoIframe;

      var setting = {
        async: {
          enable: true,
          url: "/admin/article/getmenu",
        },
        view: {
          showLine: true,
          selectedMulti: false,
        },
        callback: {
          onAsyncSuccess: zTreeOnAsyncSuccess

        }
      };

      function zTreeOnAsyncSuccess (event, treeId, treeNode, msg) {
        // console.log(treeNode)
        var treeObj = $.fn.zTree.getZTreeObj(treeId);
        treeObj.expandAll(true);
        var id = $("#" + treeId).attr("data-cate");
        curMenu = treeObj.getNodeByParam("id", id, null);
        treeObj.selectNode(curMenu);
      };

      function expandNode (e) {
        var zTree = $.fn.zTree.getZTreeObj("tree"),
          type = e.data.type,
          nodes = zTree.getSelectedNodes();
        if (type === "expandAll") {
          zTree.expandAll(true);
        } else if (type === "collapseAll") {
          zTree.expandAll(false);
        }
      }


      //-->
      $(function () {
        var t = $("#tree");
        t = $.fn.zTree.init(t, setting).expandAll(true);
        $("#expandAllBtn").bind("click", {type: "expandAll"}, expandNode);
        $("#collapseAllBtn").bind("click", {type: "collapseAll"}, expandNode);
        //搜索功能
        $("#search").click(function () {
          var url = $(this).attr('url');
          var query = $('.search-form').find('input').serialize();
          query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g, '');
          query = query.replace(/^&/g, '');
          if (url.indexOf('?') > 0) {
            url += '&' + query;
          } else {
            url += '?' + query;
          }
          window.location.href = url;
        });

        //回车自动提交
        $('.search-form').find('input').keyup(function (event) {
          if (event.keyCode === 13) {
            $("#search").click();
          }
        });

        //只有一个模型时，点击新增
        $('.document_add').click(function () {
          var url = $(this).attr('url');
          if (url !== undefined && url !== '') {
            window.location.href = url;
          }
        });
        if (localStorage.getItem("sortoggle") === 1) {
          $("#sorttoggle").addClass("active");
          $("#sortbody").removeClass("collapse");
        }
        //分类菜单
        $("#sorttoggle").click(function () {
          if (!$(this).is(".active")) {
            localStorage.setItem("sortoggle", 1)
          } else {
            localStorage.removeItem("sortoggle");
          }
        })
      })

    </script>
{% endblock %}

